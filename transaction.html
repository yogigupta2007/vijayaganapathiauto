<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Scratchcard</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://webkul.github.io/wScratchPad/wScratchPad.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f0f0f0;
      padding: 50px;
    }
    #scratch-container {
      width: 300px;
      height: 150px;
      margin: 0 auto;
      position: relative;
      cursor: pointer;
    }
    #prize {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    h2 {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<h2>Scratch Your Prize</h2>
<div id="scratch-container">
  <img id="prize" src="" alt="Prize">
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // -------------------------
  // 1ï¸âƒ£ Supabase config
  // -------------------------
  const SUPABASE_URL = 'https://qwwwiknpaypvahgdwrlc.supabase.co'; // replace
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3d3dpa25wYXlwdmFoZ2R3cmxjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NTQ1OTUsImV4cCI6MjA3NDAzMDU5NX0.xqmg68pzmthq8qvoPjxhVvAz6w_AYzFOF13iZxF1e2Q'; // replace
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // -------------------------
  // 2ï¸âƒ£ Get ID from URL
  // -------------------------
  const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get('id');

  if (!userId) {
    alert('Invalid scratchcard link!');
  }

  // -------------------------
  // 3ï¸âƒ£ Fetch prize from Supabase
  // -------------------------
  async function getPrize() {
    const { data, error } = await supabase
      .from('Scratchcards')   // replace with your table name
      .select('prize_amount')
      .eq('assigned_to', userId)
      .single();

    if (error || !data) {
      alert('Invalid or expired scratchcard!');
      return null;
    }
    return data.prize_amount;
  }

  // -------------------------
  // 4ï¸âƒ£ Initialize scratch effect
  // -------------------------
  getPrize().then(prize => {
    if (!prize) return;

    // Create a placeholder image with prize amount
    const prizeImage = `https://via.placeholder.com/300x150.png?text=â‚¹${prize}`;
    document.getElementById('prize').src = prizeImage;

    $('#scratch-container').wScratchPad({
      size: 30,           // brush size
      bg: 'silver',       // scratch layer color
      fg: prizeImage,     // prize image below
      scratchMove: function() {},
      scratchUp: function() {
        alert(`ðŸŽ‰ Congratulations! You won â‚¹${prize}`);
      }
    });
  });
</script>

</body>
</html>
